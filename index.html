<!-- I need to put this here, dont ask why --><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bread Quest</title>
    <style>
        canvas {
            border: 2px solid #000;
            background-color: #f5deb3;
            display: block;
            margin: 0 auto;
        }
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <h1>Bread Quest</h1>
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    <p>Score: <span id="score">0</span></p>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const context = canvas.getContext('2d');
        let score = 0;
        let speed = 2;
        let hazardsHit = 0;
        const maxHazards = 10;

        const toast = {
            x: 300,
            y: 350,
            width: 20,
            height: 20,
            dx: 0,
            dy: 0
        };

        const toppings = [];
        const hazards = [];

        window.addEventListener('keydown', moveToast);
        window.addEventListener('keyup', stopToast);

        function moveToast(event) {
            if (event.key === 'ArrowRight') toast.dx = speed;
            if (event.key === 'ArrowLeft') toast.dx = -speed;
            if (event.key === 'ArrowUp') toast.dy = -speed;
            if (event.key === 'ArrowDown') toast.dy = speed;
        }

        function stopToast(event) {
            if (['ArrowRight', 'ArrowLeft'].includes(event.key)) toast.dx = 0;
            if (['ArrowUp', 'ArrowDown'].includes(event.key)) toast.dy = 0;
        }

        function gameLoop() {
            clearCanvas();
            moveToastSprite();
            handleEdgeCollision();
            drawToast();
            handleItemCollision(toppings, collectTopping);
            handleItemCollision(hazards, hitHazard);
            drawItems(toppings, 'green');
            drawItems(hazards, 'red');
            generateItems(toppings, 5, 'topping');
            generateItems(hazards, 2, 'hazard');
            updateScore();
            if(hazardsHit < maxHazards) {
                requestAnimationFrame(gameLoop);
            } else {
                alert("Game Over! You hit too many hazards.");
                document.location.reload();
            }
        }

        function clearCanvas() {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        function moveToastSprite() {
            toast.x += toast.dx;
            toast.y += toast.dy;
        }

        function handleEdgeCollision() {
            if (toast.x < 0) toast.x = 0;
            if (toast.x + toast.width > canvas.width) toast.x = canvas.width - toast.width;
            if (toast.y < 0) toast.y = 0;
            if (toast.y + toast.height > canvas.height) toast.y = canvas.height - toast.height;
        }

        function drawToast() {
            context.fillStyle = 'tan';
            context.fillRect(toast.x, toast.y, toast.width, toast.height);
        }

        function generateItems(array, chance, type) {
            if (Math.random() < chance * 0.01) {
                array.push({
                    x: Math.random() * (canvas.width - 10),
                    y: Math.random() * (canvas.height - 10),
                    width: 10,
                    height: 10,
                    type: type
                });
            }
        }

        function drawItems(array, color) {
            context.fillStyle = color;
            array.forEach(item => {
                context.fillRect(item.x, item.y, item.width, item.height);
            });
        }

        function handleItemCollision(array, callback) {
            array.forEach((item, index) => {
                if (
                    toast.x < item.x + item.width &&
                    toast.x + toast.width > item.x &&
                    toast.y < item.y + item.height &&
                    toast.y + toast.height > item.y
                ) {
                    callback(index);
                }
            });
        }

        function collectTopping(index) {
            toppings.splice(index, 1);
            score += 10;
        }

        function hitHazard(index) {
            hazards.splice(index, 1);
            speed = Math.max(1, speed - 0.5);
            hazardsHit++;
            setTimeout(() => {
                speed = 2;
            }, 3000);
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
        }

        gameLoop();
    </script>
</body>
</html>