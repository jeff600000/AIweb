<!-- I need to put this here, dont ask why --><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bread Quest</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        canvas { background-color: #f4e7c5; display: block; margin: 0 auto; }
        #healthBar { position: fixed; top: 10px; left: 10px; width: 200px; height: 20px; background: lightgray; }
        .health { height: 100%; background: limegreen; }
        #narrative { position: fixed; bottom: 50px; left: 10px; background: white; padding: 10px; border: 2px solid #000; }
        #score { position: fixed; top: 10px; right: 10px; background: white; padding: 5px; border: 2px solid #000; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="healthBar"><div class="health"></div></div>
    <div id="narrative">Welcome to Bread Quest! Use arrow keys to start your journey.</div>
    <div id="score">Score: 0</div>
    <audio id="bgm" loop>
        <source src="cheerful-music.mp3" type="audio/mp3">
    </audio>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const bgm = document.getElementById('bgm');
        // Uncomment below to play music (ensure the file is available)
        // bgm.play(); 

        let player = { x: 50, y: 50, width: 40, height: 40, speed: 2 };
        let health = 100;
        let score = 0;
        let level = 1;
        let narrative = document.getElementById('narrative');
        let healthBar = document.querySelector('.health');
        let scoreDisplay = document.getElementById('score');

        let keys = {};
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);

        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            handleInput();
            checkCollisions();
            updateUI();
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "blue";
            ctx.fillRect(player.x, player.y, player.width, player.height);
            // Add more rendering for levels, ingredients, and hazards here
        }

        function handleInput() {
            if (keys['ArrowUp'] || keys['w'] && player.y > 0) player.y -= player.speed;
            if (keys['ArrowDown'] || keys['s'] && player.y < canvas.height - player.height) player.y += player.speed;
            if (keys['ArrowLeft'] || keys['a'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] || keys['d'] && player.x < canvas.width - player.width) player.x += player.speed;
        }

        function checkCollisions() {
            // This function will handle collision detection (ingredients collection, hazards interaction)
        }

        function updateUI() {
            healthBar.style.width = health + '%';
            scoreDisplay.textContent = 'Score: ' + score;
            
            // Updating narrative based on the player's level
            switch (level) {
                case 1:
                    narrative.textContent = "Level 1: Collect ingredients in the pantry!";
                    break;
                case 2:
                    narrative.textContent = "Level 2: Arrange ingredients on the counter!";
                    break;
                case 3:
                    narrative.textContent = "Level 3: Bake the perfect loaf!";
                    break;
                default:
                    narrative.textContent = "Explore and become the Bread Master!";
            }

            // Check for level progression
            if (score >= 10 && level === 1) {
                level = 2;
                // Load Level 2 setups
            } else if (score >= 20 && level === 2) {
                level = 3;
                // Load Level 3 setups
            }
        }

        gameLoop();
    </script>
</body>
</html>